
<script>
var bannerLogoPath = "$bannerLogoPath";

jQuery(function () {
	  var date = new Date();
		    var currentMonth = date.getMonth();
		    var currentDate = date.getDate();
		    var currentYear = date.getFullYear();
		    jQuery('#startDate').datepicker({
		       minDate: new Date(currentYear, currentMonth, currentDate)
		    });
		    jQuery('#endDate').datepicker({
			       minDate: new Date(currentYear, currentMonth, currentDate)
			    });
			var bannerTransistion = jQuery("#bannerTransistion").val();    
			if(jQuery.trim(bannerTransistion)!=""){
				jQuery('#ssTransition option[value="'+bannerTransistion+'"]');
				jQuery('#ssTransition').val(bannerTransistion);
			}
		    
		});


	function updateBannerList(){
		jQuery("#errMsg").html("");
		if(jQuery.trim(jQuery("#bannerListName").val())==""){
			jQuery("#errMsg").html("Please Enter Banner List Name");	
		}
		else if(jQuery('#bannerSelect > li').length == 0){
			jQuery("#errMsg").html("Please Select Banner To Save");
		}
		else{
			 $("#bannerSelect li").each(function(i, el){
		           var obj = jQuery(this).find("input[name=tempBannerId]").val();
		           jQuery("input[name=displaySeq_"+obj+"]").val($(el).index()+1);
		           console.log("bannerId : " + obj);
		        });
			var str = jQuery("#bannerListForm").serialize();
			  jQuery.ajax({
				   type: "POST",
				   url: "updateBannerCms.action",
				   data: str,
				   success: function(msg){
		   console.log("update msg :" + msg);
				   if(msg.indexOf("success")!=-1){
					   var siteId = jQuery("#siteId").val();
					   if(jQuery("#isEdit").val()=="Y"){
					   refreshBanner(jQuery("#bannerListId").val());
					   closeBannerPopup();
					   }else{
					   jQuery.getJSON("bannerDataTemplateCms.action?bannerListId=" + jQuery("#bannerListId").val()+"&reload=true", function(data) {
					   });
					   window.location.href="bannerListCms.action?reloadBanner=Y&bannerListId="+escape(jQuery.trim(jQuery("#bannerListId").val()))+"&siteId="+siteId;
					   }
			  		}else{
				   jQuery("#errMsg").html(msg);
				   }
	   			}	
	 		 });
		}
		 return false;
		}

	function loadBannerImage(page){

		  jQuery.ajax({
			   type: "GET",
			   url: "bannerImageCms.action?pageSize=12&dt="+new Date()+"&page="+page,
			   success: function(msg){
	   
			  $("#bannerEditorLeftColumn").html(msg);
			  initDraggable();
  			}	
		 });
	}

	loadBannerImage(0);
	
	function removeBanner(id){
		var delVal = jQuery("#bannerDeleteIdList").val();
		console.log(jQuery(id).closest("li").attr("id"));
		if(delVal==0){
			jQuery("#bannerDeleteIdList").val(jQuery(id).closest("li").attr("id"));
			jQuery(id).closest("li").remove();
			console.log("Del Val is zero");
		}else{
			delVal = delVal + ","+jQuery(id).closest("li").attr("id");
			jQuery("#bannerDeleteIdList").val(delVal);
			jQuery(id).closest("li").remove();
		}
		
	}

	function saveBannerList(){
		jQuery("#errMsg").html("");
		if(jQuery.trim(jQuery("#bannerListName").val())==""){
			jQuery("#errMsg").html("Please Enter Banner List Name");	
		}
		else if(jQuery('#bannerSelect > li').length == 0){
			jQuery("#errMsg").html("Please Select Banner To Save");
		}
		else{
			var str = jQuery("#bannerListForm").serialize();
			  jQuery.ajax({
				   type: "POST",
				   url: "saveBannerCms.action",
				   data: str,
				   success: function(msg){
		   
				   if(msg.indexOf("success")!=-1){
					   var siteId = jQuery("#siteId").val();
					   window.location.href="bannerListCms.action?reloadBanner=Y&bannerName="+escape(jQuery.trim(jQuery("#bannerListName").val()))+"&siteId="+siteId;
			  		}else{
				   jQuery("#errMsg").html(msg);
				   }
	   			}	
	 		 });
		}
		 return false;
		}
	

	function removeNewBanner(id){
		jQuery(id).closest("li").remove();
	}
	function initDraggable(){	
		 jQuery('.ui-draggable').draggable({
			//containment : "#unilogContainer", //makes sure that it does not flow outside the unilogCMSContainer
			helper : 'clone',
			revert : 'invalid',
			start: function( event, ui ) {
				 jQuery(this).fadeTo('fast', 0.5);
			},
			stop: function(event, ui) { 
				   jQuery(this).fadeTo(0, 1); 
			} 	 
		});
} 
	
	initDraggable();	

		var dropOpts ={
		accept: ":not(.ui-sortable-helper)",
        drop: function (event, ui) {

        	var content = ui.draggable.find('figure').data("name");
        	var bannerId = ui.draggable.find('figure').data("bannerid");
        	var insertBanner = true;
        	var checkImageName = '';
        	jQuery(this).find('#bannerSelect > li').each(function(){
            	console.log("inside : "+ bannerId);
        		checkImageName = jQuery(this).find('img').attr('src').replace(window.parent.bannerLogoPath,'');
        		console.log(content + " - " + checkImageName);
        		if (jQuery.trim(checkImageName)==jQuery.trim(content)){
        			insertBanner = false;
            		alert("Banner already selected");
        			return false;
            		}
        	        
					console.log("image list : " + jQuery(this).find('img').attr('src').replace(window.parent.bannerLogoPath,''));
            	});
        	if(insertBanner){	
        	content = "<div class='bannerContainer'><img src='"+bannerLogoPath+content+"' /></div><div class='banner_leftWrap'><div class='pull-left' style='width:100%;'>URL <input type='text' name='URL_"+bannerId+"'/></div><div class='banner_formLabel'>Caption </div><div> <input type='text' name='bannerCaptionNew_"+bannerId+"'  style='height:75px !important;'/><input type='hidden' name='bannerIdNew' value='"+bannerId+"' /><input type='hidden' name='tempBannerId' value='"+bannerId+"' /><input type='hidden' name='displaySeq_"+bannerId+"' value='' /></div><div style='float:left;width:100%;'><div class='pull-left' style='width:45%;'>Top Pos <input type='text' name='bannerTopPosNew_"+bannerId+"' style='width:50px;margin:0 0 0 5px;'/> (in px)</div><div class='pull-left' style='width:45%';>Left Pos <input type='text' name='bannerLeftPosNew_"+bannerId+"' style='width:50px;margin:0 0 0 5px;'/>(in px)<div class='clear'></div><input type='hidden' name='bannerImageNameNew' value='"+content+"'  /></div><a href='javascript:void(0);' onclick='removeNewBanner(this);' class='banner_delIcon pull-right' title='Remove From List'></a></div></div>";
        	var liVal = $('<li/>').html(content);
        	console.log(jQuery(this).attr("id"));
         	var target = jQuery('#bannerSelect');
         	
			console.log("Content : " +  content);
			
        	jQuery(liVal).appendTo(target);
        	}
        }
		};

		$("#bannerEditorRightColumn").droppable(dropOpts);


		window.closeBannerPopup = function (){
			window.parent.jQuery.colorbox.close();
			
		};

//editBannerInfo($bannerListId);
jQuery( "#bannerSelect" ).sortable({
	items: "li:not(.ui-state-disabled)",
	axis: 'y',
	placeholder: 'placeholder',
	forcePlaceholderSize: true,   opacity: 0.7,  revert: true,
	tolerance: "pointer",
    cursor: "move",
    start: function(e, ui ){
        ui.placeholder.height(ui.helper.outerHeight());
    }
	});
jQuery( "#bannerSelect" ).disableSelection();

jQuery(document).ready(function(){
	jQuery(".bannerTab").click(function(){
		jQuery("#transitionBlock").hide();
		jQuery("#carouselSettingBlock").hide();
	var bannerType = jQuery("#bannerType").val();
	if(bannerType=="slider"){
		jQuery("#transitionBlock").show();
	}else if(bannerType=="carousel"){
		jQuery("#carouselSettingBlock").show();
	}
			if(!jQuery(this).hasClass("tabSelected")){
					jQuery("#bannerEditorRightColumn").toggle();
					jQuery("#settingsBlock").toggle();
					jQuery("#bannerTab").toggleClass("tabSelected");
					jQuery("#settingsTab").toggleClass("tabSelected");
					
				}
		});
	});


	
function changeBannerType(){
	jQuery("#transitionBlock").hide();
	jQuery("#carouselSettingBlock").hide();
	var bannerType = jQuery("#bannerType").val();
	if(bannerType=="slider"){
		jQuery("#transitionBlock").show();
	}else if(bannerType=="carousel"){
		jQuery("#carouselSettingBlock").show();
	}
}

</script>